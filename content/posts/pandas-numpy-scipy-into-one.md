---
title: "Ph∆∞∆°ng ph√°p ma qu·ª∑ ƒë·ªÉ g·ªôp chung Pandas, NumPy v√† SciPy v√†o chung m·ªôt layer lambda ƒë·ªÉ ch·∫°y tr√™n Python 3.10 m√† kh√¥ng qu√° dung l∆∞·ª£ng 250M"
author: "Aperture"
date: "2024-04-22T00:20:00+07:00"
categories:
    - lambda
    - aws
    - serverless
    - experience
tags:
    - lambda
    - aws
    - experience
    - webapp
    - devops
    - python3.10
    - python
    - numpy
    - pandas
    - scipy
---

# M·ªü ƒë·∫ßu c√¢u chuy·ªán

M·ªçi th·ª© b·∫Øt ƒë·∫ßu khi t√¥i ƒë∆∞·ª£c giao m·ªôt task y√™u c·∫ßu ph·∫£i migrate t·∫•t c·∫£ function lambda c·ªßa h·ªá th·ªëng t·ª´ Python 3.8 l√™n m·ªôt phi√™n b·∫£n m·ªõi h∆°n do Python 3.8 s·∫Ω k·∫øt th√∫c v√≤ng ƒë·ªùi (EOL) v√†o 10/2024. Sau m·ªôt h·ªìi c√¢n nh·∫Øc th√¨ t√¥i quy·∫øt ƒë·ªãnh update l√™n 3.10. M·ªçi ng∆∞·ªùi c√≥ th·ªÉ h·ªèi v√¨ sao kh√¥ng update th·∫±ng l√™n 3.11+, c√¢u tr·∫£ l·ªùi ƒë∆°n gi·∫£n l√† v√¨ nhi·ªÅu th∆∞ vi·ªán Python hi·ªán t·∫°i ch∆∞a support c√°c b·∫£n m·ªõi nh∆∞ v·∫≠y, ƒëi·ªÉn h√¨nh l√† PyTorch. H∆°n n·ªØa, c√°c phi√™n b·∫£n m·ªõi c√≥ nhi·ªÅu t√≠nh nƒÉng m·ªõi kh√¥ng d√πng v√† c√≥ th·ªÉ g√¢y ra bug ti·ªÅm t√†ng. D√πng b·∫£n c≈© √≠t t√≠nh nƒÉng th√¨ s·∫Ω b·ªõt entropy ƒë·ªÉ g√¢y ra l·ªói.

C√¥ng vi·ªác n√†y bao g·ªìm 3 ph·∫ßn:

1. Ki·ªÉm tra c√°c breaking change v·ªÅ library v√† syntax t·ª´ 3.8 sang 3.10 c√≥ thay ƒë·ªïi g√¨ kh√¥ng (t·ª©c ph·∫£i xem thay ƒë·ªïi c·ªßa c·∫£ 3.9 v√† 3.10)
2. Update c√°c layer library c√≥ s·∫µn t·ª´ Python 3.8 l√™n 3.10
3. Update c√°c function v√† ƒë·ªÉ b√™n tester l√†m vi·ªác

Vi·ªác review c√°c breaking change x·∫£y ra kh√° su√¥n s·∫ª, v√¨ ph·∫ßn l·ªõn c√°c update t·ª´ 3.8 ƒë·∫øn 3.10 ch·ªß y·∫øu l√† th√™m t√≠nh nƒÉng ch·ª© kh√¥ng c√≥ thay ƒë·ªïi l·ªõn g√¨ v·ªÅ c√∫ ph√°p. C√°c th∆∞ vi·ªán c√≥ c·∫£i ti·∫øn m√† t√¥i hay d√πng l√† `concurrent.futures` c≈©ng kh√¥ng c√≥ breaking change n√†o c·∫£. Vi·ªác update ph·∫ßn l·ªõn c√°c layer library c≈©ng ƒë∆°n gi·∫£n, ngay c·∫£ th∆∞ vi·ªán hay g·∫∑p v·∫•n ƒë·ªÅ nh·∫•t l√† `cffi` c≈©ng ch·∫°y lu√¥n m·ªôt c√°ch th·∫ßn k√¨, nh·ªù v·∫≠y ph·∫ßn l·ªõn c√°c layer ƒë·ªÅu migrate l√™n Python 3.10 kh√° nhanh ch√≥ng v√† ch·∫°y kh√¥ng c√≥ v·∫•n ƒë·ªÅ g√¨. T√¥i ƒë√£ nghƒ© m·ªçi th·ª© nh∆∞ v·∫≠y l√† ·ªïn, cho ƒë·∫øn khi g·∫∑p ph·∫£i v·∫•n ƒë·ªÅ nan gi·∫£i: Cho NumPy, SciPy v√† Pandas ch·∫°y ƒë∆∞·ª£c c√πng v·ªõi nhau.

# V·∫•n ƒë·ªÅ k√≠ch th∆∞·ªõc v·ªõi NumPy, SciPy v√† Pandas

Nghi·ªáp v·ª• m√† t√¥i g·∫∑p ph·∫£i y√™u c·∫ßu ph·∫£i c√≥ c·∫£ 3 th∆∞ vi·ªán SciPy, NumPy v√† Pandas ch·∫°y c√πng v·ªõi nhau. N·∫øu b·∫°n d√πng SciPy, NumPy v√† Pandas th√¨ c≈©ng hi·ªÉu c√°c k√≠ch th∆∞·ªõc c√°c th∆∞ vi·ªán n√†y r·∫•t n·∫∑ng. Ngo√†i code ra, c√°c th∆∞ vi·ªán tr√™n c√≤n ch·ª©a c·∫£ th∆∞ vi·ªán ph·ª• tr·ª£ k√®m theo, c√°c th∆∞ vi·ªán `.so` ƒë√£ build ra (`OpenBLAS` v√† `GFortran` cho NumPy v√† SciPy, m·ªói th∆∞ vi·ªán d√πng m·ªôt phi√™n b·∫£n) n√™n t·ªïng c·∫£ th∆∞ m·ª•c n√†y c√≥ k√≠ch th∆∞·ªõc l√™n t·ªõi 278M, trong khi AWS Lambda ch·ªâ cho ph√©p t·ªïng T·∫§T C·∫¢ c√°c layer l·∫°i trong m·ªôt function l√† 250M, t·ª©c l√† t√¥i ƒë√£ qu√° 28M so v·ªõi gi·ªõi h·∫°n, ƒë·∫•y l√† ch∆∞a k·ªÉ ph·∫£i ch·ª´a ch·ªó cho c√°c layer v√† code kh√°c.

·ªû runtime Python 3.8, AWS cung c·∫•p s·∫µn 2 layer sau:

- `AWSLambda-Python38-SciPy1x`: Bao g·ªìm SciPy v√† NumPy
- `AWSSDKPandas-Python38`: Bao g·ªìm Pandas v√† NumPy

V√† vi·ªác nh√©t m·ªôt l√∫c c·∫£ 2 layer n√†y v√†o m·ªôt function c≈©ng g√¢y ra l·ªói qu√° k√≠ch th∆∞·ªõc n·ªët. T√¥i ƒë√£ exploit vi·ªác Pandas kh√¥ng c√≥ th∆∞ vi·ªán r·ªùi, n√™n ƒë√£ t·∫£i xu·ªëng m·ªôt layer ch·ªâ c√≥ m·ªôt m√¨nh Pandas m√† kh√¥ng c√≥ NumPy:

```bash
pip install pandas --target python
rm -r python/numpy*/
```

V·∫≠y l√† layer m·ªõi n√†y ch·ªâ ch·ª©a m·ªói Pandas v√† c√°c dependency kh√°c c·ªßa n√≥ n√™n nh·ªè h∆°n, ch·ªâ c√≤n kho·∫£ng 70M. Khi d√πng th√¨ ch·ªçn c·∫£ layer n√†y v√†o c√πng v·ªõi `AWSLambda-Python38-SciPy1x`, th√¨ c·∫£ k·∫øt qu·∫£ ta ƒë∆∞·ª£c 1 function c√≥ ƒë·∫ßy ƒë·ªß Pandas, SciPy v√† NumPy c√πng m·ªôt ch·ªó. Nh∆∞ ·ªü tr√™n theo l√Ω thuy·∫øt th√¨ kh√¥ng th·ªÉ, nh∆∞ng c√≥ l·∫Ω b·∫£n build custom c·ªßa AWS ƒë√£ t·ªëi ∆∞u vi·ªác dynamic linking t·ªõi c√°c th∆∞ vi·ªán c√≥ s·∫µn trong m√¥i tr∆∞·ªùng n√™n ƒë√£ ti·∫øt ki·ªám ƒë∆∞·ª£c th√™m v√†i ch·ª•c MB.

Nh∆∞ng khi l√™n runtime Python 3.10, AWS ch·ªâ cung c·∫•p m·ªôt layer `AWSSDKPandas-Python310` ch·ª©a Pandas v√† NumPy m√† kh√¥ng cung c·∫•p layer n√†o ch·ª©a SciPy nh∆∞ 3.8 c·∫£. V·∫≠y l√† t√¥i ƒë·ª©ng gi·ªØa ng√£ ba ƒë∆∞·ªùng, t·∫°o layer ch·ª©a c·∫£ 3 th√¨ n·∫∑ng nh√©t kh√¥ng v·ª´a, m√† t·∫°o layer ch·ª©a m·ªói Pandas ƒë·ªÉ d√πng v·ªõi layer SciPy c√≥ s·∫µn nh∆∞ h·ªìi d√πng Python 3.8 th√¨ v√¥ nghƒ©a v√¨ l√†m g√¨ c√≥ layer n√†o nh∆∞ `AWSLambda-Python38-SciPy1x` m√† d√πng. Trong b√†i to√°n c·ªßa t√¥i, th√¨ ngo√†i 3 th∆∞ vi·ªán tr√™n th√¨ c·∫ßn ph·∫£i tr·ªëng kho·∫£ng 15-20M n·ªØa ƒë·ªÉ d√†nh cho c√°c layer kh√°c. Ph√∫c b·∫•t trung lai ho·∫° v√¥ ƒë∆°n ch√≠, t√¥i v·ª´a ph·∫£i nh√©t 3 c√°i th∆∞ vi·ªán to ƒë√πng v√†o 1 layer m√† v·ª´a ph·∫£i ƒë·∫£m b·∫£o t·∫°o ra c√°i layer c√≥ k√≠ch th∆∞·ªõc nh·ªè h∆°n 230M.

ƒê·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y, t√¥i ƒë∆∞a ra 5 ph∆∞∆°ng √°n:

|   | Ph∆∞∆°ng √°n                                                                                                                               | V·∫•n ƒë·ªÅ g·∫∑p ph·∫£i                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---|-----------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 | Gi·ªØ nguy√™n c√°c function c·∫ßn 3 th∆∞ vi·ªán tr√™n ·ªü Python 3.8                                                                                | Y√™u c·∫ßu b·∫Øt bu·ªôc ph·∫£i n√¢ng c·∫•p l√™n 3.10 do v·∫•n ƒë·ªÅ security, ch·ªâ gi·ªØ l·∫°i layer v√† runtime 3.8 ƒë·ªÉ ph·ª•c v·ª• nhu c·∫ßu code legacy c·ªßa kh√°ch h√†ng                                                                                                                                                                                                                                                                                                   |
| 2 | Nh√©t t·∫•t c·∫£ code v√† th∆∞ vi·ªán v√†o Docker do AWS Lambda c√≥ th·ªÉ ch·∫°y 1 Docker image l√™n t·ªõi 10G      | Cold start c·ªßa Lambda Docker kh√° l·ªõn c·ªông v·ªõi cold start khi ch·∫°y code l·∫ßn ƒë·∫ßu, l√™n t·ªõi 8-12s ho·∫∑c h∆°n, n√™n ch·ªâ ph√π h·ª£p v·ªõi c√°c background task ƒë·ªÉ tr√°nh vi·ªác ng∆∞·ªùi d√πng ph·∫£i ƒë·ª£i cold start.<br>Hi·ªán t·∫°i ch·ªâ c√≥ c√°c tr∆∞·ªùng h·ª£p d√πng c√°c library l·ªõn nh∆∞ Torch, Tensorflow l√† ph·∫£i d√πng ƒë·∫øn Docker, trong khi r·∫•t nhi·ªÅu function ng∆∞·ªùi d√πng th∆∞·ªùng xuy√™n g·ªçi v√†o ph·∫£i d√πng ƒë·∫øn NumPy, SciPy v√† Pandas.<br>Cold start l·ªõn qu√° khi·∫øn ng∆∞·ªùi d√πng b·ª±c b·ªôi v√¨ ƒë·ª£i l√¢u (kh√°ch h√†ng ƒë√£ th·ª±c s·ª± than phi·ªÅn v√¨ ƒëi·ªÅu n√†y).<br>H∆°n n·ªØa ƒë∆∞a code v√†o Docker s·∫Ω khi·∫øn qu√° tr√¨nh dev tr·ªü n√™n kh√≥ khƒÉn h∆°n do ph·∫£i build c·∫£ Docker Image l√™n ƒë·ªÉ test. |
| 3 | Mount EFS v√†o function v√† c√†i th∆∞ vi·ªán v√†o ƒë√≥, sau ƒë√≥ d√πng m·ªôt v√†i trick ƒë·ªÉ Python c√≥ th·ªÉ detect ƒë∆∞·ª£c v·ªã tr√≠ th∆∞ vi·ªán v√† l√¥i ra s·ª≠ d·ª•ng | EFS kh√¥ng ch·ªãu ƒë∆∞·ª£c t·∫£i cao, khi c√≥ qu√° nhi·ªÅu client connect v√†o th√¨ EFS s·∫Ω qu√° t·∫£i. Vi·ªác access li√™n t·ª•c c√°c file nh·ªè trong EFS c≈©ng kh√¥ng hi·ªáu qu·∫£, ƒë·ªôi gi√° chi ph√≠ (g·ªìm chi ph√≠ l∆∞u tr·ªØ v√† bƒÉng th√¥n). <br>H∆°n n·ªØa th√™m EFS v√†o l√† th√™m m·ªôt ƒëi·ªÉm ch·∫øt v√†o h·ªá th·ªëng                                                                                |
| 4 | Build l·∫•y m·ªôt b·∫£n NumPy, Pandas v√† SciPy ri√™ng v√† optimize c√°c th∆∞ vi·ªán OpenBLAS, GFortran cho h·ªç                                       | Vi·ªác build kh√° kh√≥ v√† t·ªën nhi·ªÅu th·ªùi gian, kh√¥ng h·ªÅ c√≥ h∆∞·ªõng d·∫´n g√¨ tr√™n m·∫°ng. Ch·∫°y b·∫£n build custom d·ªÖ x·∫£y ra l·ªói b√≠ hi·ªÉm r·∫•t kh√≥ s·ª≠a.                                                                                                                                                                                                                                                                                                                                               |
| 5 | Xo√° b·ªõt code trong c√°c th∆∞ vi·ªán ƒëi cho nh·ªè h∆°n 230M _*(MA QU·ª∂ üíÄüíÄüíÄ)*_                                                                     | Kh√¥ng r√µ b√™n trong c√≥ nh·ªØng g√¨ an to√†n ƒë·ªÉ xo√°. Kh√¥ng n√≥i c≈©ng bi·∫øt ƒë√¢y l√† bad practice.                                                                                                                                                                                                                                                                                                                                                                                   |

Sau khi th·ª≠ c·∫£ 4 ph∆∞∆°ng √°n, t√¥i th·∫•y ph∆∞∆°ng √°n 4 l√† nhanh nh·∫•t v√† ch∆∞a x·∫£y ra v·∫•n ƒë·ªÅ g√¨ c·∫£. C√¢u chuy·ªán c·ª• th·ªÉ s·∫Ω ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p ·ªü d∆∞·ªõi.

# Con ƒë∆∞·ªùng d·∫´n t·ªõi ph∆∞∆°ng √°n ma qu·ª∑

Sau khi v·∫≠t l·ªôn v·ªõi vi·ªác build NumPy, Pandas v√† SciPy, ƒë·ªëi ph√≥ v·ªõi th∆∞ vi·ªán BLAS v√† GFortran c·ªßa Amazon Linux, t√¥i v·∫´n kh√¥ng t√¨m ƒë∆∞·ª£c ra c√°ch build k√®m static link c√°c th∆∞ vi·ªán ƒë√≥ m√† kh√¥ng v∆∞·ª£t qu√° k√≠ch th∆∞·ªõc 230M ·ªü tr√™n. V√† **ch·∫≥ng c√≥ con AI** n√†o ƒë∆∞a ra m·ªôt ph∆∞∆°ng √°n ra g√¨ ƒë·ªÉ gi·∫£i tho√°t t√¥i kh·ªèi v·∫•n ƒë·ªÅ nan gi·∫£i n√†y.

Sau r·∫•t nhi·ªÅu bao S√†i G√≤n b·∫°c v√† ƒë√†o x·ªõi c√°c th·ªÉ lo·∫°i GitHub Issues v√† StackOverflow th√¨ cu·ªëi c√πng t√¥i t√¨m ra m·ªôt √Ω t∆∞·ªüng clean up repo SciPy kh√° t√† ƒë·∫°o trong m·ªôt c√°i Issue c·ªßa GitHub repo [keithrozario/Klayers](https://github.com/keithrozario/Klayers/issues/360#issuecomment-1893493985):

{{< figure 
    src="/posts/pandas-numpy-scipy-into-one/github-issue.png"
    position="center"
    alt="√ù t∆∞·ªüng clean up repo SciPy tr√™n GitHub Issue"
    title="√ù t∆∞·ªüng clean up repo SciPy tr√™n GitHub Issue"
    attr="keithrozario/Klayers"
    attrlink="https://github.com/keithrozario/Klayers/issues/360#issuecomment-1893493985"
    link="https://github.com/keithrozario/Klayers/issues/360#issuecomment-1893493985">}}

Nh∆∞ ƒë·ªÅ c·∫≠p, th√¨ t√¥i c√≥ th·ªÉ xo√° bay xo√° bi·∫øn th∆∞ m·ª•c `tests` trong c√°c folder con v√† c√°c file `scipy/misc/*.dat` trong SciPy m√† kh√¥ng g√¢y l·ªói cho th∆∞ vi·ªán. Sau m·ªôt h·ªìi ƒëi·ªÅu tra trong code c·ªßa SciPy, th√¨ c√≥ v·∫ª th∆∞ m·ª•c `tests` n√†y ch·ªâ ƒë∆∞·ª£c d√πng trong l√∫c test khi build xong. C√≤n c√°c file `.dat` l√† c√°c file dataset m·∫´u c·ªßa SciPy, `ascent.dat` l√† file ch·ª©a ·∫£nh 8bit grayscale, `ecg.dat` ƒë·ªÉ ch·ª©a d·ªØ li·ªáu ƒëi·ªán t√¢m ƒë·ªì m·∫´u, c√≤n `face.dat` l√† ch·ª©a ·∫£nh c·ªßa g·∫•u m√®o ü¶ù. Th·ª±c t·∫ø l√† `scipy.misc` n√†y ƒë√£ b·ªã deprecate t·ª´ b·∫£n SciPy `v1.10.0`, nh∆∞ng th·∫ø qu√°i n√†o n√≥ v·∫´n ·ªü ƒë√¢y ƒë·ªÉ l√†m n·∫∑ng c√°i th∆∞ vi·ªán n√†y.

Kh√¥ng ch·ªâ d·ª´ng l·∫°i ·ªü SciPy, t√¥i th·∫•y NumPy c≈©ng c√≥ c√°c directory `tests` nh∆∞ v·∫≠y, k√≠ch th∆∞·ªõc c≈©ng kh·ªßng kh√¥ng k√©m. N√™n t√¥i c≈©ng xo√° s·∫°ch c√°c directory test ƒë√≥ ƒëi lu√¥n. C√≥ v·∫ª do d√πng chung `mesos` l√†m build backend n√™n ch√∫ng c√≥ chung m·ªôt k·∫øt qu·∫£ nh∆∞ v·∫≠y.

Cu·ªëi c√πng, ƒë·ªÉ ti·∫øt ki·ªám h·∫øt m·ª©c, t√¥i xo√° h·∫øt c√°c directory `dist-info` ƒëi v√† c≈©ng kh√¥ng t·∫°o bytecode sau khi build ƒë·ªÉ ti·∫øt ki·ªám dung l∆∞·ª£ng h∆°n n·ªØa.

K·∫øt qu·∫£, t√¥i thu ƒë∆∞·ª£c m·ªôt layer c√≥ k√≠ch th∆∞·ªõc v·ªèn v·∫πn ch·ªâ c√≤n 192M, t·ª©c l√† t·ªõi ti·∫øt ki·ªám ƒë∆∞·ª£c t·ªõi 80M kh√¥ng d√πng ƒë·∫øn. V·∫≠y l√† t√¥i ƒë√£ v∆∞·ª£t ch·ªâ ti√™u t·∫≠n h∆°n 30M.

{{< figure 
    src="/posts/pandas-numpy-scipy-into-one/final-size.png"
    position="center"
    alt="K·∫øt qu·∫£ sau khi cleanup"
    title="K·∫øt qu·∫£ sau khi cleanup"
    attr="blog.haivq.com" >}}

# Ph∆∞∆°ng ph√°p t·∫°o ra layer ma qu·ª∑

> L∆∞u √Ω: Vi√™c can thi·ªáp tr·ª±c ti·∫øp v√†o source code c·ªßa th∆∞ vi·ªán l√† m·ªôt vi·ªác r·∫•t t·ªá, d·ªÖ g√¢y ra l·ªói khi kh√¥ng t√¨m hi·ªÉu kƒ©, m√† k·ªÉ c·∫£ t√¨m hi·ªÉu kƒ© v·∫´n c√≥ th·ªÉ g√¢y l·ªói nh∆∞ th∆∞·ªùng. N·∫øu c√≥ th·ªÉ b·∫°n h√£y d√πng c√°ch kh√°c thay v√¨ ph∆∞∆°ng ph√°p _ma qu·ª∑_ n√†y üíÄüíÄüíÄ.

V·∫≠y c√°c b∆∞·ªõc ƒë·ªÉ t·∫°o ra m·ªôt layer nh·ªè c√≥ th·ªÉ t√≥m g·ªçn trong c√°c b∆∞·ªõc sau ƒë√¢y:

```bash
# t·∫£i th∆∞ vi·ªán v·ªÅ, kh√¥ng t·∫°o bytecode v√† ch·ªâ t·∫£i b·∫£n CPython
pip install numpy pandas scipy --no-compile --implementation cp -t python

# Xo√° h·∫øt c√°c th∆∞ m·ª•c dist-info kh√¥ng c·∫ßn ƒë·∫øn
rm -r *.dist-info

# Xo√° h·∫øt c√°c th∆∞ m·ª•c l√° (leaf directory) tests c·ªßa t·∫•t c·∫£ c√°c th∆∞ vi·ªán
find . | grep -E "*/tests$" | xargs rm -rf

# Xo√° h·∫øt bytecode m√† Python sinh ra n·∫øu c√≥
find . | grep -E "(/__pycache__$|\.pyc$|\.pyo$)" | xargs rm -rf

# Xo√° c·∫£ pyproject v√¨ kh√¥ng c·∫ßn ƒë·∫øn
find . | grep -E "pyproject.toml$" | xargs rm -rf

# Xo√° c√°c file .dat trong SciPy kh√¥ng d√πng t·ªõi
find . | grep -E "scipy\misc\*.dat$" | xargs rm -rf
```

Nh∆∞ v·∫≠y l√† t√¥i ƒë√£ ho√†n th√†nh vi·ªác gi·∫£m k√≠ch th∆∞·ªõc layer. V√† sau khi test tr√™n lambda th√¨ n√≥ **TH·ª∞C S·ª∞ ƒê√É CH·∫†Y üíÄüíÄüíÄ**. C√≥ l·∫Ω ƒë√¢y l√† ph∆∞∆°ng ph√°p _ma qu·ª∑_ nh·∫•t m√† t√¥i t·ª´ng bi·∫øt ƒë·ªÉ nh·ªìi nh√©t th∆∞ vi·ªán v√†o trong m·ªôt layer Lambda.

# L√Ω do l·ªãch s·ª≠ v·ªÅ vi·ªác xu·∫•t hi·ªán th∆∞ m·ª•c `tests` trong th∆∞ vi·ªán SciPy/NumPy

ƒê·ªÉ gi·∫£i th√≠ch cho l√Ω do v√¨ sao th∆∞ m·ª•c `tests` l·∫°i ƒë∆∞·ª£c nh√©t v√†o trong th∆∞ vi·ªán SciPy/NumPy, anh b·∫°n H√† Lan [rgommers](https://github.com/rgommers), c≈©ng l√† ng∆∞·ªùi maintain NumPy v√† SciPy, ƒë√£ ƒë∆∞a ra [gi·∫£i th√≠ch nh∆∞ sau](https://github.com/keithrozario/Klayers/issues/360#issuecomment-2076527549):

{{< figure 
    src="/posts/pandas-numpy-scipy-into-one/explanation.png"
    position="center"
    alt="L√Ω do th∆∞ m·ª•c `tests` ƒë∆∞·ª£c ƒë∆∞a v√†o trong th∆∞ vi·ªán"
    title="L√Ω do th∆∞ m·ª•c `tests` ƒë∆∞·ª£c ƒë∆∞a v√†o trong th∆∞ vi·ªán"
    attr="keithrozario/Klayers"
    attrlink="https://github.com/keithrozario/Klayers/issues/360#issuecomment-2076527549"
    link="https://github.com/keithrozario/Klayers/issues/360#issuecomment-2076527549">}}

T√≥m t·∫Øt ng·∫Øn g·ªçn l·∫°i, l√† ng√†y x∆∞a nhi·ªÅu ng∆∞·ªùi build NumPy/SciPy l·∫°i t·ª´ ƒë·∫ßu, khi build xong h·ªç ph·∫£i ch·∫°y `numpy.test()` ƒë·ªÉ ki·ªÉm tra xem c√≥ l·ªói l·∫ßm kh√π kho·∫±m g√¨ x·∫£y ra hay kh√¥ng. Gi·ªù kh√¥ng c·∫ßn thi·∫øt ph·∫£i build l·∫°i NumPy v√† SciPy n·ªØa, nh∆∞ng b√¢y gi·ªù can thi·ªáp b·∫•t k√¨ ƒëi·ªÅu g√¨ trong NumPy v√† SciPy ƒë·ªÅu r·∫•t nguy hi·ªÉm, d·ªÖ c√≥ l·ªói x·∫£y ra (v√¨ gi·ªù c√°i project to qu√° r·ªìi). C√°i g√¨ kh√¥ng h·ªèng th√¨ t·ªët nh·∫•t kh√¥ng n√™n ƒë·ªông v√†o n√™n th√¥i ƒë√†nh k·ªá th∆∞ m·ª•c `tests` ƒë√≥ v·∫≠y.

# T·ªïng k·∫øt

Nh∆∞ v·∫≠y l√† th√¥ng qua vi·ªác inspect th∆∞ vi·ªán Python ƒë√£ install, t√¥i ƒë√£ ti·∫øt ki·ªám r·∫•t nhi·ªÅu dung l∆∞·ª£ng khi ƒë∆∞a ch√∫ng v√†o layer. ƒêi·ªÅu n√†y l√†m t√¥i nh·ªõ t·ªõi c√¢u chuy·ªán c·ªßa NaughtyDog khi l√†m Crash Bandicoot, khi Andy Gavin ƒë√£ t√¨m c√°ch xo√° b·ªõt th∆∞ vi·ªán C c·ªßa Sony ƒëi ƒë·ªÉ gi·∫£i ph√≥ng RAM tr√™n m√°y PS1 ƒë·ªÉ h·ªç c√≥ th·ªÉ load ƒë∆∞·ª£c nhi·ªÅu n·ªôi dung h∆°n trong game.

{{< youtube id=izxXGuVL21o title="C√°ch Crash Bandicoot Hack Playstation 1" >}}

# Ngu·ªìn tham kh·∫£o

- [GitHub](https://github.com)
    - [keithrozario/Klayers / Issue #360: Scipy lambda layer for 3.9 and 3.10](https://github.com/keithrozario/Klayers/issues/360) / [archive](https://web.archive.org/web/20240902142402/https://github.com/keithrozario/Klayers/issues/360)
